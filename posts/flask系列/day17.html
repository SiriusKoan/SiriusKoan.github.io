<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 17 實作測試 (3)</title>
    <link rel="icon" href="/img/me.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/gist.css">
</head>

<body>
    <header>
        <nav>
            <a href="/" class="header-content">SiriusKoan</a>
            <a href="/posts" class="header-content">Posts</a>
            <a href="/about.html" class="header-content">About Me</a>
        </nav>
    </header>
    <a id="top-button" href="#"><span>TOP</span></a>
    <div id="toc">
        <a href="#前言">前言</a>
        <a href="#test_admin">test_admin</a>
        <a href="#後記">後記</a>
    </div>
    <main>
        <h1 id="title"><a href="#">Day 17 實作測試 (3)</a></h1>
        <div class="post_content" id="前言">
            <h2><a href="#前言">前言</a></h2>
            <p>
                今天要來看看最後的 <code>admin_bp</code> 的測試。一樣，我們不會做完全每個頁面的測試，就大概展示一下就好。
            </p>
        </div>
        <div class="post_content" id="test_admin">
            <h2><a href="#test_admin">test_admin</a></h2>
            <p>
                話不多說，我們一樣一個一個測試來看，前面說過的就不再多贅述了。
            </p>
            <script src="https://gist.github.com/SiriusKoan/9f96323e370b14c2786363551f9a91eb.js"></script>
            <p>
                這是管理員控制台的測試，但這是給貼文的 (<code>admin_dashboard_posts_page</code>)，給留言的也同理
                (<code>admin_dashboard_comments_page</code>)，就不特別再寫了。當然它會有很多功能，但我們就先跳過。因為這是管理員的頁面，所以我們用
                <code>test_get_with_admin_auth</code>
                來測試一個用管理員登入之後再抓這個頁面，他的 <code>assertIn</code> 一樣是判斷 navbar。而如果只是一般使用者跑來這個頁面的話，他會回傳
                403。在這邊他在沒有登入的狀況下抓這個控制台頁面他會回傳 200，這是因為我們到時候會把 401 處理掉，變成重新導向到登入頁面之類的。
            </p>
            <p>
                接下來是使用者管理介面的測試。
            </p>
            <script src="https://gist.github.com/SiriusKoan/a00077103611a8b78dc06af5d11e828e.js"></script>
            <p>
                在 <code>setUp</code> 裡面我們放了一個 OK
                的資料和一個有欄位留空的資料，這兩筆資料都是用來新增一個使用者的，我們之後會把一個新增使用者的表單放在這裡，讓管理員可以快速新增帳號。這個判斷空欄位一樣是 Flask-WTF
                處理的，也當然可以自訂這個錯誤訊息。在測試 OK 的資料裡面，我們也加了一個訊息，這是到時候新增使用者成功時會 <code>flash</code>
                出來的，同樣的道理，在登入、註冊等等頁面也都可以加入類似的訊息來判斷。
            </p>
        </div>
        <div class="post_content" id="後記">
            <h2><a href="#後記">後記</a></h2>
            <p>
                到這邊為止，我們就把簡略的測試寫好了。當然有很多頁面根本沒測試到，也有很多功能也都沒有去特別處理，但這就是展示，如果需要的話可以自己想想覺得還缺甚麼，然後慢慢補齊。
            </p>
            <p>
                我們在寫測試的最一開始有在 <code>manage.py</code> 裡面加入一個 <code>flask test</code> 的指令，現在全部寫完了，可以來跑跑看。沒有意外的話應該會噴出一堆
                error (基本上都是路徑抓不到的問題) 跟 failed，我們最後的目標就是把他們修到好。
            </p>
        </div>
    </main>
    <footer>
        <p id="copyright">© 2021 <a href="https://github.com/SiriusKoan" target="_blank">SiriusKoan</a></p>
    </footer>
</body>

</html>