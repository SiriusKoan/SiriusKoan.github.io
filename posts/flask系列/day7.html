<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 7 jinja (2)</title>
    <link rel="icon" href="/img/me.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/gist.css">
</head>

<body>
    <header>
        <nav>
            <a href="/" class="header-content">SiriusKoan</a>
            <a href="/posts" class="header-content">Posts</a>
            <a href="/about.html" class="header-content">About Me</a>
        </nav>
    </header>
    <a id="top-button" href="#"><span>TOP</span></a>
    <div id="toc">
        <a href="#前言">前言</a>
        <a href="#範例">範例</a>
        <a href="#set&with">set & with</a>
        <a href="#import">import</a>
        <a href="#References">References</a>
    </div>
    <main>
        <h1 id="title"><a href="#">Day 7 jinja (2)</a></h1>
        <div class="post_content" id="前言">
            <h2><a href="#前言">前言</a></h2>
            <p>
                今天要繼續看 jinja 的使用，昨天的內容比較接近一般的變數存取、if、for 的使用，而今天的內容則是類似自定義函數。
            </p>
        </div>
        <div class="post_content" id="範例">
            <h2><a href="#範例">範例</a></h2>
            <p>
                先來看個範例。請注意 <code>index.html</code> 和 <code>msg.jinja</code> 都要放在昨天提到的 <code>templates</code> 裡面。
            </p>
            <script src="https://gist.github.com/SiriusKoan/532711139a998b245f8fc5c54d5b59b4.js"></script>
            <p>
                這次的檔案比較多，也比較繁雜，我們一個一個慢慢看。
            </p>
            <p>
                <code>app.py</code> 基本上就是昨天用來解釋 for 的範例，但是新加入了一個叫做 <code>flash</code> 的函式
                ，它的用途是把後端的資料送到前端顯示。比如說可能使用者在註冊帳號的時候，使用者名稱已經被用過了，那後端就可以發一條警告訊息到前端通知使用者這個名稱被使用了。雖然這裡說是前端，但基本上它也是由
                jinja 去跑的，所以需要用 <code>render_template</code>。在他的後面我們加了一個 <code>category</code>
                的參數，這是選用，它的功能就是放一個標籤給這條訊息，讓前端可以因應，例如說上面的名稱已被使用可能就是 <code>warning</code>，而註冊成功可能就是 <code>success</code>
                之類的，在下面我們會用到它。
            </p>
            <p>
                這裡還有一個需要注意的是，有一行
                <code>app.config["SECRET_KEY"] = "rc498mt6848"</code>，<code>app.config</code> 是這個 app
                的設定檔，未來會有更舒服的方式去設定他，而 <code>SECRET_KEY</code> 是這個 <code>app</code> 的 secret key，會用來幫忙處理一些
                session 的東西，像是此處的 <code>flash</code>、登入的 session、未來會提到的 <code>csrf_token</code>
                等等都會用到它，而有了它也可以反推前述的東西，因此不能外流，此處只是隨便亂打，而且在開發模式，所以是沒有關係的。
            </p>
            <p>
                如果你在思考這個 <code>flash</code> 的東西到底去哪裡了，可以看看 <code>session</code>，但一樣要記得先 import
                (<code>from flask import session</code>)。應該可以看到類似
                <code>&lt;SecureCookieSession {'_flashes': [('meow', 'meow')]}&gt;</code> 的內容。這個訊息還有一個特性是，在被前端使用過之後就會自動從
                <code>session</code> 中消失，所以同樣的訊息不會一直卡著。
            </p>
            <p>
                接下來看到 <code>index.html</code>，他在最一開始就 import，但是這並不是 python 的 import，他 import 的是一個 jinja
                的檔案，而這個檔案在下方，我們等等就會看到。在 <code>body</code> 裡面，我們呼叫剛剛引入的 <code>display_msg</code>，並將
                <code>get_flashed_messages(with_categories=True)</code> 作為其引數。這個函式就是用來抓 <code>session</code> 裡面有哪些
                <code>flash</code> 的訊息，後面的 <code>with_categories</code> 是說明要不要加上 <code>category</code>，預設是
                <code>False</code>。他的表示方式是一個 list，以此處為例，有 <code>with_categories=True</code> 的結果會是
                <code>[("cat", "meow")]</code>、沒有打或是設為 <code>False</code> 會得到 <code>["meow"]</code>。
            </p>
            <p>
                最後看到 <code>msg.jinja</code>，他就像是一個 module，裡面有一個函式可以給別人引入。首先，就如同 if 和 for，他也需要
                <code>endmacro</code>，接下來我們可以看到他在 jinja 裡面跑著非常接近 python 的語法，也可以發現剛剛設定的 <code>category</code> 被當成
                <code>class</code> 來用。
            </p>
        </div>
        <div class="post_content" id="set&with">
            <h2><a href="#set&with">set & with</a></h2>
            <p>
                在前面講存取變數的時候，可能有人會好奇我們該如何設變數，因為之後用不太到，所以沒有放在前面講，我自己覺得不太會用到的原因是因為我們會用到的變數都已經在 <code>render_template</code>
                中設定好了，剩下可能會用到的變數大概也只是 for 的時候會用到的區域變數，所以我個人覺得這個部分不太會使用，等等也不會放上範例。但我自己也真的有用過，像是想要把一些設定檔交給 jinja
                去對照，那就會先把設定檔 import
                進模板 (如何 import 等等會提到)，然後給他一個變數名稱作為簡寫之類的。
            </p>
            <p>
                標題寫著 <code>set & with</code>，代表這裡有兩種設定變數的方式，差異只在是全域變數還是區域變數而已。我們分開來說。
            </p>
            <ul>
                <li><code>set</code> 的用法是 <code>{% set var=value %}</code>，非常簡單。</li>
                <li>
                    <code>with</code> 就比較麻煩一點，他建立了一個 scope，也就是說他創造的是區域變數。他的用法是 <code>{% with var=value %}</code>，但在這個
                    scope 結束的時候要 <code>{% endwith %}</code>，和前面提到的類似。
                </li>
            </ul>
        </div>
        <div class="post_content" id="import">
            <h2><a href="#import">import</a></h2>
            <p>
                雖然我們是在 python 裡面用 jinja，但是在 jinja 中我們無法使用 python 的函式庫。如果真的要使用的話，我們需要一點小技巧。但我自己是認為，能不要用就不要用。
            </p>
            <p>
                python 裡面有一個套件叫做 <code>importlib</code>，我們可以在 <code>render_template</code> 後面加上
                <code>IMPORT=importlib.import_module</code> (<code>import</code> 在 jinja 裡面是保留字，所以不能用)，然後在模板裡面就可以
                <code>set var=IMPORT('module')</code>，照著正常該怎麼用就可以了。
            </p>
        </div>
        <div class="post_content attachment" id="References">
            <h2><a href="#References">References</a></h2>
            <a href="https://flask.palletsprojects.com/en/2.0.x/config/#SECRET_KEY">Configuration Handling -
                SECRET_KEY</a>
            <a href="https://stackoverflow.com/questions/29549259/how-does-the-with-statement-work-in-flask-jinja2">How
                does the 'with' statement work in Flask (Jinja2)?</a>
            <a
                href="https://stackoverflow.com/questions/53132094/whare-are-the-difference-between-set-and-with-in-jinja">Whare
                are the difference between set and with in jinja</a>
            <a href="https://stackoverflow.com/questions/4828406/import-a-python-module-into-a-jinja-template">Import a
                Python module into a Jinja template?</a>
        </div>
    </main>
    <footer>
        <p id="copyright">© 2021 <a href="https://github.com/SiriusKoan" target="_blank">SiriusKoan</a></p>
    </footer>
</body>

</html>