<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 4 基本 flask 函式 (1)</title>
    <link rel="icon" href="/img/me.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/gist.css">
</head>

<body>
    <header>
        <nav>
            <a href="/" class="header-content">SiriusKoan</a>
            <a href="/posts" class="header-content">Posts</a>
            <a href="/about.html" class="header-content">About Me</a>
        </nav>
    </header>
    <a id="top-button" href="#"><span>TOP</span></a>
    <div id="toc">
        <a href="#前言">前言</a>
        <a href="#範例一">範例一</a>
        <a href="#範例二">範例二</a>
        <a href="#結語">結語</a>
    </div>
    <main>
        <h1 id="title"><a href="#">Day 4 基本 flask 函式 (1)</a></h1>
        <div class="post_content" id="前言">
            <h2><a href="#前言">前言</a></h2>
            <p>
                昨天提到了一些 flask 的例子，而今天會繼續深入討論他提供的一些函式，可以讓寫出來的網頁有更多的變化。
            </p>
        </div>
        <div class="post_content" id="範例一">
            <h2><a href="#範例一">範例一</a></h2>
            <p>
                首先我們來看個例子，這個網頁裏面包含了數個路徑，我們一一來檢視。
            </p>
            <script src="https://gist.github.com/SiriusKoan/933aa18581b9570333edc21b6a36e779.js"></script>
            <ul>
                <li>第一個路徑跟昨天的一樣，就是首頁。</li>
                <li>
                    第二個路徑會幫我們重新導向 (redirect) 至 google，他使用了 <code>redirect</code> 這個函式，而我們需要先從 flask import
                    他。再來要注意的是，並不是單單 <code>redirect(url)</code> 就可以了，前面必須要加上 <code>return</code>。
                </li>
                <li>
                    第三個路徑一樣會幫我們重新導向至 google，但他的方法是先重新導向到第二個路徑，再由他重新導向至 google。其中用到了 <code>url_for</code> 這個函式，一樣要先
                    import。在 <code>url_for()</code> 填的參數是要導向的函式名稱，請注意是函式名稱
                    (字串)，而非函式本身，也不是該路徑，如果要看完整對應表的話可以使用
                    <code>app.url_map</code>。他會找出該函式對應到的路徑，以此處為例，<code>url_for("redirect_to_google")</code> 會回傳
                    <code>"/google"</code>，然後就會變成 <code>return redirect("/google")</code>，然後就會導向到剛剛的第二個路徑。
                </li>
                <li>
                    最後一個路徑會直接回傳 <code>403 Forbidden</code>。這裡使用的是 <code>abort</code> 函式，一樣需要先 import。他很直接，就是會直接回傳指定的
                    指定的 HTTP status code，但必須要是一個錯誤的 code (<code>404</code>、<code>418</code>、<code>500</code>
                    等等)。這裡要注意的是，他不需要 <code>return</code>，但他跟
                    <code>return</code> 一樣，都會直接把後面的程式忽略。有了這個函式，我們可以更輕鬆的處理錯誤。如果不想要直接 <code>abort</code>
                    還想要有其他回傳東西的話，那可以改用 <code>return "", 404</code>，空字串的部分可以自由改動，flask 會回傳你指定的 HTML 並附加該 HTTP status
                    code。
                </li>
            </ul>
        </div>
        <div class="post_content" id="範例二">
            <h2><a href="#範例二">範例二</a></h2>
            <p>
                昨天有提到 <code>return</code> 只有某些型別可用，我舉的例子是 <code>str</code> 和
                <code>Response</code>，這裡要說明的就是後者。這邊一樣先提供一個範例，它包含了兩個路徑。
            </p>
            <script src="https://gist.github.com/SiriusKoan/873f3953c0ee0d1c9f15678dc0e67211.js"></script>
            <ul>
                <li>
                    第一個路徑中，我們先宣告了一個 <code>response</code> 變數，使用到了 <code>make_response</code> 函式，他也需要
                    import。這個函式的參數基本上就是在前面的例子中 <code>return</code> 的內容，如 <code>redirect</code>、一般的字串、或是未來會提到的
                    <code>render_template</code> 等等，這邊方便起見就隨便放一個字串。接下來我們可以設定該 response 的標頭，此處用常見的
                    <code>Content-Type</code>
                    作為範例，標頭是一個 <code>dict</code>，所以可以直接用此方式更改。再接著我們設定 cookie，使用的是 <code>Response</code> 物件的
                    <code>set_cookie</code> 函式，第一個參數是 cookie 名稱，第二個參數是 cookie 的值。最後我們傳回這個
                    response，可以打開開發人員工具來看看是否都有跑出正確的樣子。
                </li>
                <li>
                    第二個路徑看起來就是第一個路徑的相反，他會刪除 cookie。要使用的是 <code>Response</code> 物件的 <code>delete_cookie</code> 函式，他只需要接
                    cookie 的名稱就可以刪除。這時候打開瀏覽器看 cookie 應該可以看到 <code>user</code> 欄位已經被清空。這邊可以注意的是，在網路上查有些人會直接
                    <code>set_cookie("user", expire=0)</code>，這樣也是正確的，事實上，<code>delete_cookie</code>
                    這個函數的實作就是這樣做，只是把它包起來罷了。
                </li>
            </ul>
            <p>
                這邊的 <code>set_cookie</code> 和 <code>delete_cookie</code> 都還有很多參數可以加，像是剛剛的 <code>expire</code>
                等等，但就不再這邊多說了，有需要的人可以看一下他的原始碼，註解應該都蠻清楚的。
            </p>
        </div>
        <div class="post_content" id="結語">
            <h2><a href="#結語">結語</a></h2>
            <p>
                今天看了一些進階的 flask 函式，有了這些函式可以讓我們能夠更細膩地設計網站。在本篇文章的內容都沒有深入討論該函式的其他用法，如果有興趣的人可以再看看文件及原始碼。
            </p>
        </div>
        <div class="post_content attachment" id="References">
            <h2><a href="#References">References</a></h2>
            <a href="https://stackoverflow.com/questions/25860304/how-do-i-set-response-headers-in-flask">How do I set response headers in Flask?</a>
            <a href="https://stackoverflow.com/questions/46661083/how-to-set-cookie-in-python-flask">How to set cookie in Python Flask?</a>
        </div>
    </main>
    <footer>
        <p id="copyright">© 2021 <a href="https://github.com/SiriusKoan" target="_blank">SiriusKoan</a></p>
    </footer>
</body>

</html>