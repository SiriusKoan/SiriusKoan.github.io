<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 5 基本 flask 函式 (2)</title>
    <link rel="icon" href="/img/me.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/gist.css">
</head>

<body>
    <header>
        <nav>
            <a href="/" class="header-content">SiriusKoan</a>
            <a href="/posts" class="header-content">Posts</a>
            <a href="/about.html" class="header-content">About Me</a>
        </nav>
    </header>
    <a id="top-button" href="#"><span>TOP</span></a>
    <div id="toc">
        <a href="#前言">前言</a>
        <a href="#前置作業">前置作業</a>
        <a href="#範例一">範例一</a>
        <a href="#範例二">範例二</a>
        <a href="#範例三">範例三</a>
        <a href="#References">References</a>
    </div>
    <main>
        <h1 id="title"><a href="#">Day 6 jinja (1)</a></h1>
        <div class="post_content" id="前言">
            <h2><a href="#前言">前言</a></h2>
            <p>
                今天要來看 jinja 這個模板引擎。簡單來說，它的功能就是在 HTML 裡面執行一般程式，等等看過範例之後應該可以更清楚它的作用。
            </p>
            <p>
                雖然說是在執行一般程式，但是其語法和一般程式也有一些些差別，我自己的習慣是照著一般程式的語法，如果錯了的話再去搜尋正確的用法。
            </p>
        </div>
        <div class="post_content" id="前置作業">
            <h2><a href="#前置作業">前置作業</a></h2>
            <p>
                這次並非只需要簡單地把程式碼複製到 <code>app.py</code> 而已，我們需要先建立一個名為 <code>templates</code> 的資料夾，名字必須完全符合，等等會需要把 HTML
                及以後會用到的 jinja 模板放在裡面。
            </p>
        </div>
        <div class="post_content" id="範例一">
            <h2><a href="#範例一">範例一</a></h2>
            <p>
                建立完資料夾後，我們來看看以下這份程式碼，請注意 <code>index.html</code> 需要放在 <code>templates</code> 目錄內。
            </p>
            <script src="https://gist.github.com/SiriusKoan/3bc52f45899f20da1113b1255b83303f.js"></script>
            <p>
                在 <code>app.py</code> 中，我們看到了一個新的函式：<code>render_template</code>，不例外地，他也需要 import。它的功用是把一個 template 送入
                jinja 跑，然後就可以得到一個字串，內容就是跑出來的 HTML，最後會把他 return 回去，這樣一來，使用者就可以收到一個漂亮的 HTML，而非之前連 <code>head</code>
                都沒有的單純內容。有了它的好處是，我們不需要把超長的 HTML 放在 python 檔案裡面，而且可以用比較漂亮的方式生出 HTML，等等在看 for
                迴圈的時候會更有感覺。
            </p>
            <p>
                它需要一個 template name，以此處為例就是 <code>index.html</code>。接下來會看到他後面的 <code>username=name</code>，他會把剛剛定義的
                <code>name</code> 傳入 template 給 jinja 處理，而在 jinja 裡面，他的名字叫做 <code>username</code>。接著我們看到
                <code>index.html</code>，它裡面有一行 <code>{{ username }}</code>，在
                jinja 裡面，我們使用大括號來表示我們存取的變數，此處就是剛剛在 <code>redner_template</code> 傳入的 <code>name</code>。
            </p>
            <p>
                這邊值得注意的是，jinja 只會去處理大括號的部分，其他 HTML 的元素他秋毫無犯，會原汁原味秀出來。
            </p>
        </div>
        <div class="post_content" id="範例二">
            <h2><a href="#範例二">範例二</a></h2>
            <p>
                剛剛看了基本的使用方法，現在來看看 if 要怎麼處理。
            </p>
            <script src="https://gist.github.com/SiriusKoan/db530f3fa7f29cc7983c57b21c077c5d.js"></script>
            <p>
                我們這次傳入了 <code>state</code> 這個變數，然後在 jinja 裡面判斷他是否等於 <code>running</code>。這裡要注意的是他 if
                並不是跟剛剛一樣用兩個大括號，而是一個大括號和一個百分符號。這兩種的差別在於他是不是一個 statement，<code>{% %}</code> 是給 statement 用的，而
                <code>{{ }}</code> 則是用來存取內容用的。還有跟 python 不太一樣的是他有 <code>endif</code>，要記得加。也因為他已經有了
                <code>endif</code>，所以他不會管你的縮排。
            </p>
            <p>
                還有一個要注意的是，我們的 <code>&lt;p&gt;running&lt;/p&gt;</code> 和 <code>&lt;p&gt;terminated&lt;/p&gt;</code>
                並沒有加上大括號，因為他就是一般的 HTML element。如果要把 <code>running</code> 換成 <code>state</code>，那就要改成
                <code>&lt;p&gt;{{ state }}&lt;/p&gt;</code>。
            </p>
        </div>
        <div class="post_content" id="範例三">
            <h2><a href="#範例三">範例三</a></h2>
            <p>
                接下來就要講迴圈，比較特別的是 jinja 只有 for 沒有 while，以下是一個範例。
            </p>
            <script src="https://gist.github.com/SiriusKoan/68dab6df4804c730029ce8c50263f143.js"></script>
            <p>
                在這個範例中我們傳入了一個叫做 <code>users</code> 的 list，接下來我們交給 jinja 處理，他幫我們跑一個 for 迴圈 (注意他也是 statement，所以要用
                <code>{% %}</code>)，依序把 <code>users</code> 裡的
                <code>user</code> 取出來，然後放在 <code>li</code> 裡面。接下來看到後面的 <code>loop.index</code>，他是一個預設就存在的變數，他表示了平常在 list
                看到的 index，但他是從 1 開始數，如果要從零開始數需要用 <code>loop.index0</code>。
            </p>
            <p>
                最後看到在 <code>user</code> 後面的
                <code>| upper</code>，他是一個 filter，就是等同於平常用到的 <code>str.upper()</code>，只是在此處我們習慣使用 filter。在此處當然可以直接
                <code>{{ user.upper() }}</code> 就好，但是有些時候沒有辦法用 python 的語法來處理，像是如果我們直接使用 <code>int()</code>，他會告訴我們
                undefined，這時候就需要用 <code>| int</code> 來達成需求。
            </p>
            <p>
                如果想要加入自定義的 filter 的話，flask 已經有一個包裝好的方法可以處理，以下是範例。
            </p>
            <script src="https://gist.github.com/SiriusKoan/d4c7765df225a0fc4f579fd4d7e386c2.js"></script>
            <p>
                可以看到在 <code>app.py</code> 的最前面我們使用了 <code>app.template_filter</code>，讓他裝飾了一個會丟出第一個字母的函式，接下來在
                <code>index.html</code> 我們就直接使用了這個 filter，不需要把它當成參數放在 <code>render_template</code>，也不需要特別
                import，他就直接變成了預設就存在的 filter。
            </p>
        </div>
        <div class="post_content attachment" id="References">
            <h2><a href="#References">References</a></h2>
            <a href="https://docs.exponea.com/docs/jinja-syntax">Basic Syntax of Jinja</a>
            <a href="https://hackmd.io/@shaoeChen/SJ0X-PnkG?type=view">Python jinja2 + flask</a>
            <a href="https://michaelcho.me/article/custom-jinja-template-filters-in-flask">Custom Jinja template filters
                in Flask</a>
        </div>
    </main>
    <footer>
        <p id="copyright">© 2021 <a href="https://github.com/SiriusKoan" target="_blank">SiriusKoan</a></p>
    </footer>
</body>

</html>