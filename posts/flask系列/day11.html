<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 11 實作 create_app</title>
    <link rel="icon" href="/img/me.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/gist.css">
</head>

<body>
    <header>
        <nav>
            <a href="/" class="header-content">SiriusKoan</a>
            <a href="/posts" class="header-content">Posts</a>
            <a href="/about.html" class="header-content">About Me</a>
        </nav>
    </header>
    <a id="top-button" href="#"><span>TOP</span></a>
    <div id="toc">
        <a href="#前言">前言</a>
        <a href="#前置作業">前置作業</a>
        <a href="#create_app">create_app</a>
        <a href="#References">References</a>
    </div>
    <main>
        <h1 id="title"><a href="#">Day 11 實作 create_app</a></h1>
        <div class="post_content" id="前言">
            <h2><a href="#前言">前言</a></h2>
            <p>
                前幾天有提到在工廠模式中，我們會用一個函式把全部 <code>app</code> 生起來，今天要實作的就是這個函式，一般習慣會使用 <code>create_app</code> 或
                <code>make_app</code>，我們選擇使用前者。
            </p>
        </div>
        <div class="post_content" id="前置作業">
            <h2><a href="#前置作業">前置作業</a></h2>
            <p>
                如同昨天所說，我們在 <code>create_app</code> 裡面會需要初始化一些東西，而這其中包括了資料庫。而我們會另外開一個 <code>app/database</code>
                來處理資料庫的事務，初始化會用到的 <code>db</code> 也不例外，所以我們先來處理一下資料庫的相關作業。以下程式碼都會放在 <code>app/database</code> 中。
            </p>
            <script src="https://gist.github.com/SiriusKoan/9977e89b0963bf0fc0a25cf39dd91d85.js"></script>
            <p>
                很明顯地，<code>app/database</code> 也是一個 package。我們在 <code>models.py</code> 裡面宣告了 <code>db</code>
                這個變數，也就是等等我們需要初始化 <code>app</code> 的幫手。接著在 <code>__init__.py</code> 裡面把 <code>db</code>
                引入，這樣等等就可以讓別人引入。這個
                <code>models.py</code> 是未來用來放資料庫結構的地方，但是我們還沒到那個部分，就先留著這樣就好。
            </p>
        </div>
        <div class="post_content" id="create_app">
            <h2><a href="#create_app">create_app</a></h2>
            <p>
                接下來，我們就來看看該怎麼寫吧。我們要把這個函式放在 <code>app/__init__.py</code> 裡面。
            </p>
            <script src="https://gist.github.com/SiriusKoan/ec567fba64b4158f824e9ba57b8d3c45.js"></script>
            <p>
                一開始要先注意一下最後面 <code># Blueprint</code>
                後面的程式碼，他們目前都不存在，在未來我們會實做到。跟之前說過的一樣，基本上他們就是一堆路徑，然後分門別類放好，讓我們好管理。我們會用 <code>register_blueprint</code>
                這個函式把整個藍圖加入 <code>app</code> 裡面。我們也可以使用 <code>url_prefix</code> 這個參數來設定這個藍圖的母路徑，例如說，我們設定
                <code>url_prefix="/auth"</code>，那在這個藍圖裡面的路徑前面都會被冠上 <code>/auth</code>，如果他用的路徑是 <code>/login</code>，那
                register 過後就會變成 <code>/auth/login</code>。但我們在此專案不會用到，所以先略過。
            </p>
            <p>
                接著看到最上面的一堆引入，我們引入了 <code>LoginManager</code>，他是 <code>Flask-Login</code> 的核心。也引入了
                <code>Mail</code>，他也是一個核心的概念，之後要寄信的時候就會直接找他。<code>Pagedown</code> 和 <code>Markdown</code>
                也是相同的概念。再來是剛剛弄好的
                <code>db</code>，我們也需要他來初始化。最後還有之前寫好的設定檔對照表，讓我們可以根據環境來決定要用哪個設定。
            </p>
            <p>
                接下來看到在下面我們把 <code>LoginManager</code>、<code>Mail</code>、<code>Pagedown</code> 和實體化，因為等等會用到這三個實體去初始化。
            </p>
            <p>
                終於進入 <code>create_app</code> 函式本身了，當然我們需要先弄出 <code>app</code>，但這次的宣告和之前的範例有些不同，多了
                <code>template_folder</code> 和 <code>static_folder</code> 兩個參數，應該可以猜到，他們就是用來指定 jinja 模板目錄和 JS、CSS
                那些檔案的目錄的，預設值分別是 <code>templates</code> 和 <code>static</code>，如果不喜歡這個名字也可以自己改掉。這邊會需要設定是因為我們這兩個目錄跟
                <code>__init__.py</code> 不是同一層目錄，需要往上一層。這個 <code>create_app</code> 接受了 <code>env</code>
                這個參數，接下來我們就要用他來匯入之前寫的設定檔。flask 很好心地有一個函是可以讓我們直接從物件匯入，也就是此處的
                <code>app.config.from_object</code>，這樣一來，我們就可以抓到之前寫的設定檔了。
            </p>
            <p>
                最後是初始化的部分，我們需要把五個東西都初始化，這樣才能在往後的開發中使用。要初始化的方法是使用他們的 <code>init_app</code> 函式，並以 <code>app</code>
                作為參數。但 <code>Markdown</code> 比較特別，他沒有 <code>init_app</code> 這個函式，所以要像 <code>db</code>
                那樣子做，而其他三個其實也可以不要先實體化變成 <code>login_manager</code>，然後在 <code>init_app</code> 的位置初始化，像是
                <code>login_manager=LoginManager(app)</code>。但當然 <code>db</code> 沒有辦法這樣做，畢竟他在其他地方就定義好了。
            </p>
        </div>
        <div class="post_content attachment" id="References">
            <h2><a href="#References">References</a></h2>
            <a href="https://flask.palletsprojects.com/en/2.0.x/blueprints/">Modular Applications with Blueprints</a>
        </div>
    </main>
    <footer>
        <p id="copyright">© 2021 <a href="https://github.com/SiriusKoan" target="_blank">SiriusKoan</a></p>
    </footer>
</body>

</html>