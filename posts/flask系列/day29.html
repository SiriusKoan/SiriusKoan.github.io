<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 29 實作 admin_bp (2)</title>
    <link rel="icon" href="/img/me.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/gist.css">
</head>

<body>
    <header>
        <nav>
            <a href="/" class="header-content">SiriusKoan</a>
            <a href="/posts" class="header-content">Posts</a>
            <a href="/about.html" class="header-content">About Me</a>
        </nav>
    </header>
    <a id="top-button" href="#"><span>TOP</span></a>
    <div id="toc">
        <a href="#前言">前言</a>
        <a href="#posts&comments">posts & comments</a>
        <a href="#manage_user">manage_user</a>
    </div>
    <main>
        <h1 id="title"><a href="#">Day 29 實作 admin_bp (2)</a></h1>
        <div class="post_content" id="前言">
            <h2><a href="#前言">前言</a></h2>
            <p>
                快要結束了，今天要繼續寫 <code>admin_bp</code>。今天的內容會用到 JS，但我不會多加解釋。
            </p>
        </div>
        <div class="post_content" id="posts&comments">
            <h2><a href="#posts&comments">posts & comments</a></h2>
            <p>
                我們直接把 <code>admin_dashboard_posts_backend</code> 和 <code>admin_dashboard_comments_backend</code> 一起看，，因為他們真的很接近，一樣從資料庫開始。
            </p>
            <script src="https://gist.github.com/SiriusKoan/dc16f1e8538b159d924f3d21f3e64e7a.js"></script>
            <p>
                雖然兩個都是刪除，但刪除貼文比較麻煩一點，因為留言是附在貼文下面的，所以要連著留言一起刪掉才行。
            </p>
            <p>
                在進入 HTML 之前，我們要先看看 JS。
            </p>
            <script src="https://gist.github.com/SiriusKoan/5cd2a769d51245a59a58dbe123a3222f.js"></script>
            <p>
                這裡我們使用了 jquery 來做 ajax，在使用者按下刪除按鈕之後就送出 request 讓後端刪除。
            </p>
            <p>
                接下來是 HTML，基本上就是昨天寫好的檔案，只是要稍微加一些東西。
            </p>
            <script src="https://gist.github.com/SiriusKoan/333d92d818a9ba9a57ed79010c6da5e7.js"></script>
            <p>
                我們多引入了剛剛寫的 <code>admin.js</code> 以及 jquery 的 JS 檔案。接著我們調整了一下刪除的按鈕，把他多加了一個 <code>onclick</code> 來執行剛剛寫的 JS。
            </p>
            <p>
                最後要看到路徑的部分，兩個非常接近。
            </p>
            <script src="https://gist.github.com/SiriusKoan/f6ef7a5a7421eebe7007f5652cdaab3e.js"></script>
            <p>
                在這邊我們又看到 <code>request</code> 並用了他的 <code>get_json</code> 函式。這邊加了一個 <code>force=True</code>，是因為 flask 會偵測 request 的 MIME type，如果不是 JSON 他就會不讓你 parse，加了這個參數之後他不管如何就是會 parse，但如果內容不是 JSON 的話他還是會噴錯誤。接下來就是嘗試刪除，不成功的話就 <code>abort</code>。
            </p>
        </div>
        <div class="post_content" id="manage_user">
            <h2><a href="#manage_user">manage_user</a></h2>
            <p>
                最後要做的部分是管理使用者頁面的更新和刪除按鈕。一樣先從資料庫看起。
            </p>
            <script src="https://gist.github.com/SiriusKoan/e9a601e64285c3b66c6022b2973877bf.js"></script>
            <p>
                這邊只有刪除的，因為更新的函式在之前寫過了。跟剛剛刪除貼文類似，我們也需要把使用者的貼文和留言一起刪掉。
            </p>
            <p>
                再來一樣先看看 JS，更新的部分跟剛剛稍微有些不同。
            </p>
            <script src="https://gist.github.com/SiriusKoan/0034e48c593961ece36cbce742d36fc4.js"></script>
            <p>
                光看這樣子應該無法理解 <code>update_user</code> 的 element 在幹嘛，所以我們直接看看 HTML，JS 的引入就不重複打了。
            </p>
            <script src="https://gist.github.com/SiriusKoan/89be03bbeba85723af562a9efa39f95b.js"></script>
            <p>
                我們修改了底下的兩個按鈕，更新的按鈕直接把自己這個 element 傳入 JS，所以剛剛看到的 <code>element</code> 就是這個按鈕。然後在 <code>update_user</code> 裡面就去把每個欄位的值抓出來，丟給後端 python 處理。
            </p>
            <p>
                最後來看到路徑。
            </p>
            <script src="https://gist.github.com/SiriusKoan/5e3c4c97d8aff9acaf42d4de5240b4ad.js"></script>
            <p>
                因為有更新和刪除兩個功能，所以要先判斷 <code>request.method</code>，然後再分別去更新，有問題的話就 <code>abort(400)</code>。
            </p>
        </div>
    </main>
    <footer>
        <p id="copyright">© 2021 <a href="https://github.com/SiriusKoan" target="_blank">SiriusKoan</a></p>
    </footer>
</body>

</html>
